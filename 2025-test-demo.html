<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025년 시험 시스템 테스트</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .subject-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .subject-card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; cursor: pointer; }
        .subject-card:hover { background: #f5f5f5; }
        .subject-card.loaded { background: #e8f5e8; border-color: #4caf50; }
        .stats { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; }
        .questions { margin-top: 20px; }
        .question { background: white; border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .loading { text-align: center; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎓 2025년 시험 시스템 테스트</h1>
        
        <div class="stats" id="stats">
            <h3>📊 시스템 통계</h3>
            <div id="statsContent">로딩 중...</div>
        </div>
        
        <h3>📚 과목별 로드 테스트</h3>
        <div class="subject-grid" id="subjectGrid">
            <!-- 동적으로 생성됨 -->
        </div>
        
        <div class="questions" id="questions">
            <!-- 선택된 과목의 문제들이 여기에 표시됨 -->
        </div>
    </div>

    <script src="2025-exam-optimized.js"></script>
    <script>
        // DOM 로드 후 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeTestPage();
        });
        
        function initializeTestPage() {
            updateStats();
            createSubjectCards();
        }
        
        function updateStats() {
            const stats = window.getExamStats2025();
            const performance = window.exam2025Performance.getStats();
            
            document.getElementById('statsContent').innerHTML = `
                <p><strong>총 과목 수:</strong> ${stats.total_subjects}</p>
                <p><strong>총 문제 수:</strong> ${stats.total_questions}</p>
                <p><strong>로드된 과목:</strong> ${stats.loading_progress}</p>
                <p><strong>세션 시간:</strong> ${Math.round(performance.session_duration / 1000)}초</p>
                <p><strong>평균 로드 시간:</strong> ${Math.round(performance.average_load_time || 0)}ms</p>
            `;
        }
        
        function createSubjectCards() {
            const subjects = window.getAllSubjects2025();
            const grid = document.getElementById('subjectGrid');
            
            grid.innerHTML = subjects.map(subject => {
                const metadata = window.getSubjectMetadata2025(subject);
                return `
                    <div class="subject-card" data-subject="${subject}" onclick="loadSubjectTest('${subject}')">
                        <h4>${subject}</h4>
                        <p>문제 수: ${metadata.total_questions}개</p>
                        <p>상태: <span id="status-${subject}">${metadata.loaded ? '로드됨' : '대기중'}</span></p>
                    </div>
                `;
            }).join('');
        }
        
        async function loadSubjectTest(subjectName) {
            const statusEl = document.getElementById(`status-${subjectName}`);
            const card = document.querySelector(`[data-subject="${subjectName}"]`);
            
            try {
                statusEl.textContent = '로딩중...';
                
                const startTime = Date.now();
                const questions = await window.getQuestionsForSubject2025(subjectName);
                window.exam2025Performance.recordLoadTime(subjectName, startTime);
                
                statusEl.textContent = '로드됨';
                card.classList.add('loaded');
                
                displayQuestions(subjectName, questions.slice(0, 3)); // 처음 3문제만 표시
                updateStats();
                
            } catch (error) {
                statusEl.textContent = '실패';
                console.error('로드 실패:', error);
                alert(`${subjectName} 로드 실패: ${error.message}`);
            }
        }
        
        function displayQuestions(subjectName, questions) {
            const questionsEl = document.getElementById('questions');
            
            questionsEl.innerHTML = `
                <h3>📋 ${subjectName} (샘플 ${questions.length}문제)</h3>
                ${questions.map((q, index) => `
                    <div class="question">
                        <h4>문제 ${index + 1}</h4>
                        <p><strong>Q:</strong> ${q.question}</p>
                        <p><strong>정답:</strong> ${q.correct}</p>
                        <p><strong>해설:</strong> ${q.explanation}</p>
                        ${q.detailedExplanation ? `<p><strong>상세해설:</strong> ${q.detailedExplanation.substring(0, 200)}...</p>` : ''}
                    </div>
                `).join('')}
            `;
        }
    </script>
</body>
</html>